@model MemigrationProBonoTracker.Models.CaseViewModels.CreateCaseViewModel
<form asp-action="Create">
    <br />
    <div class="form">
        <div class="row">
            <h1>New Case</h1>
            <div asp-validation-summary="All" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="Type" class="col-md-4 control-label"></label>
                <div class="col-md-10">
                    <select asp-for="Type" asp-items="Html.GetEnumSelectList<Enums.CaseType>()" class="form-control"></select>
                    <span asp-validation-for="Type" class="text-danger"></span>
                </div>
            </div>
        </div>
        <hr />
        <div class="row panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">Lead Client</h3>
            </div>
            <input asp-for="@Model.LeadClient.Id" type="hidden" />
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-lg-5">
                        <label asp-for="@Model.LeadClient.FirstName" class="col-md-2 control-label"></label>
                        <div class="col-md-10">
                            <input asp-for="@Model.LeadClient.FirstName" class="form-control" />
                            <span asp-validation-for="@Model.LeadClient.FirstName" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group col-lg-5">
                        <label asp-for="@Model.LeadClient.LastName" class="col-md-2 control-label"></label>
                        <div class="col-md-10">
                            <input asp-for="@Model.LeadClient.LastName" class="form-control" />
                            <span asp-validation-for="@Model.LeadClient.LastName" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-2">
                        <button type="button" id="LaunchClientSearchModal" class="btn btn-primary pull-right">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-lg-5">
                        <label asp-for="@Model.LeadClient.DateOfBirth" class="col-md-2 control-label"></label>
                        <div class="col-md-10">
                            <input asp-for="@Model.LeadClient.DateOfBirth" class="form-control datepickerpast" />
                            <span asp-validation-for="@Model.LeadClient.DateOfBirth" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group col-lg-5">
                        <label asp-for="@Model.LeadClient.Gender" class="col-md-2 control-label"></label>
                        <div class="col-md-10">
                            <select asp-for="@Model.LeadClient.Gender" asp-items="Html.GetEnumSelectList<Enums.Gender>()" class="form-control"></select>
                            <span asp-validation-for="@Model.LeadClient.Gender" class="text-danger"></span>
                        </div>
                    </div>
                    </div>
                <div class="row">
                    <div class="form-group col-lg-5">
                        <label asp-for="@Model.LeadClient.Nationality" class="col-md-2 control-label"></label>
                        <div class="col-md-10">
                            <select asp-for="@Model.LeadClient.Nationality" asp-items="Html.GetEnumSelectList<Enums.Country>()" class="form-control"></select>
                            <span asp-validation-for="@Model.LeadClient.Nationality" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group col-lg-5">
                        <label asp-for="@Model.LeadClient.AlienNumber" class="col-md-2 control-label"></label>
                        <div class="col-md-10">
                            <input asp-for="@Model.LeadClient.AlienNumber" class="form-control" />
                            <span asp-validation-for="@Model.LeadClient.AlienNumber" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row panel panel-primary">
            <div class="panel-heading">
                <h2 class="panel-title">Assigning Attorney</h2>
            </div>
            <br/>
            <input id="AssigningAttorneyId" asp-for="@Model.AssigningAttorneyId" hidden=""/>
            <div class="col-lg-5">
                <h3 id="AssigningFullName">&nbsp;</h3>
            </div>
            <div class="col-lg-5">
                <h3 id="AssigningOrgName">&nbsp;</h3>
            </div>
            <div class="col-lg-2">
                <button type="button" id="LaunchAssigningAttorneySearchModal" class="btn btn-primary pull-right">
                    <span class="glyphicon glyphicon-search"></span>
                </button>
            </div>
            <span asp-validation-for="@Model.AssigningAttorneyId" class="text-danger"></span>
        </div>
    </div>
    <div class="row panel panel-primary">
        <div class="panel-heading">
            <h2 class="panel-title">Case Events</h2>
        </div>
        <table id="CaseEventsTable" class="table table-striped table-hover table-bordered">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Event</th>
                    <th>
                        <button type="button" id="AddCaseEvent" class="btn btn-primary">
                            <span class="glyphicon glyphicon-plus"></span>
                        </button>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input class="form-control datepickerfuture" asp-for="@Model.CaseEvents[0].EventDate" /></td>
                    <td><input class="form-control" asp-for="@Model.CaseEvents[0].Event" /></td>
                    <td>
                        <button type="button" class="btn btn-primary caseEventRemove">
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="row panel panel-primary">
        <div class="panel-heading">
            <h2 class="panel-title">Case Notes</h2>
        </div>
        <div class="panel-body">
            <div class="col-lg-12 textwrapper">
                <textarea style="max-width: 1080px" cols="2" rows="8" asp-for="CaseNotes" class="form-control"></textarea>
                <span asp-validation-for="CaseNotes" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="col-lg-12">
        <a asp-action="Index">Back to List</a>
        <div class="pull-right">
            <input type="submit" value="Create" class="btn btn-primary" />
        </div>

    </div>
</form>
<div id="modalWrapper" class="modal fade" tabindex="-1" role="dialog"></div>

<script>
    $(function () {
        $("#LeadClient_AlienNumber").mask("A999-999-999");
        $("#LaunchAssigningAttorneySearchModal").click(function () {
            $.ajax({
                url: '/Attorney/GetAttorneyLookupPartial/?assigning=' + true,
                success: function (data) {
                    $('#modalWrapper').html(data);
                }
            });
        });
        $("#LaunchClientSearchModal").click(function () {
            $.ajax({
                url: '/People/PersonLookupPartial/',
                success: function (data) {
                    $('#modalWrapper').html(data);
                    $(".PersonSearchModalChoose").click(function () {
                        var Row = $(this).closest('tr');
                        var firstname = Row.children('.fname').val();
                        var lastname = Row.children('.lname').val();
                        var nationality = Row.children('td.Nationality').text().trim();
                        var age = Row.children('#item_Age').val();
                        var gender = Row.children('#item_Gender').val();
                        var rawdob = Row.children('.dob').val().split(' ');
                        var alienNum = Row.children('#item_AlienNumber').val();
                        var id = this.id;
                        var dob = new Date(rawdob[0]);
                        $("#LeadClient_FirstName").val(firstname);
                        $("#LeadClient_LastName").val(lastname);
                        $("#LeadClient_Id").val(id);
                        $("#LeadClient_Age").val(age);
                        $("#LeadClient_AlienNumber").val(alienNum);
                        document.getElementById('LeadClient_DateOfBirth').value = dob.getFullYear() + "-" + String("00" + dob.getMonth()).slice(-2) + "-" + String("00" + dob.getDate()).slice(-2);
                        $("#LeadClient_Gender option").filter(function () { return this.text == gender; }).attr('selected', true);
                        $("#LeadClient_Nationality option").filter(function () { return this.text == nationality; }).attr('selected', true);
                        $('#modalWrapper').modal('hide');
                    });
                }
            });

        });
        $("#AddCaseEvent").click(function () {
            var len = $('#HiddenTableInput').val();
            var datecell = '<input class="form-control datepicker" type="datetime" data-val="true" id="CaseEvents_' + len + '__EventDate" name="CaseEvents[' + len + '].EventDate" value="">';
            var eventcell = '<input class="form-control" type="text" id="CaseEvents_' + len + '__Event" name="CaseEvents[' + len + '].Event" value="">';
            var btncell = '<button type="button" class="btn btn-primary caseEventRemove"><span class="glyphicon glyphicon-remove"></span></button>';
            $("#CaseEventsTable").append('<tr><td>' + datecell + '</td><td>' + eventcell + '</td><td>' + btncell + '</td></tr>');
            initDatePickers();
            bindRemoveEventRow();
        });
        bindRemoveEventRow();
    });

    function bindRemoveEventRow() {
        $(".caseEventRemove").click(function () {
            var tr = $(this).closest('tr');
            tr.css("background-color", "#FF3700");
            tr.fadeOut(400, function () {
                tr.remove();
                $('#CaseEventsTable tr:last-child td:last-child button').removeAttr("disabled");
            });
        });
    }
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

}
